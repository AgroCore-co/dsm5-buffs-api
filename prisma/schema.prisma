generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Enums para o model Alertas
enum NichoAlerta {
  CLINICO
  SANITARIO
  REPRODUCAO
  MANEJO
}

enum PrioridadeAlerta {
  BAIXA
  MEDIA
  ALTA
}

// Models
model Endereco {
  id_endereco      BigInt        @id @default(autoincrement())
  pais             String        @db.VarChar(50)
  estado           String        @db.VarChar(50)
  cidade           String        @db.VarChar(50)
  bairro           String?       @db.VarChar(50)
  rua              String?       @db.VarChar(100)
  cep              String?       @db.VarChar(10)
  numero           String?       @db.VarChar(10)
  ponto_referencia String?       @db.VarChar(150)
  created_at       DateTime      @default(now())
  updated_at       DateTime      @updatedAt
  Usuario          Usuario[]
  Propriedade      Propriedade[]

  @@map("enderecos")
}

model Raca {
  id_raca    BigInt   @id @default(autoincrement())
  nome       String   @db.VarChar(50)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  Bufalo     Bufalo[]

  @@map("racas")
}

model Grupo {
  id_grupo         BigInt         @id @default(autoincrement())
  nome_grupo       String         @db.VarChar(50)
  nivel_maturidade String?        @db.VarChar(1)
  color            String?        @db.VarChar(7)
  id_propriedade   BigInt?
  created_at       DateTime       @default(now())
  updated_at       DateTime       @updatedAt
  Propriedade      Propriedade?   @relation(fields: [id_propriedade], references: [id_propriedade])
  Bufalo           Bufalo[]
  MovLote          MovLote[]
  AlimRegistro     AlimRegistro[]

  @@map("grupos")
}

model AlimentacaoDef {
  id_aliment_def   BigInt         @id @default(autoincrement())
  tipo_alimentacao String         @db.VarChar(50)
  descricao        String?        @db.VarChar(200)
  id_propriedade   BigInt?
  created_at       DateTime       @default(now())
  updated_at       DateTime       @updatedAt
  Propriedade      Propriedade?   @relation(fields: [id_propriedade], references: [id_propriedade])
  AlimRegistro     AlimRegistro[]

  @@map("alimentacao_defs")
}

model Industria {
  id_industria   BigInt       @id @default(autoincrement())
  nome           String?      @db.VarChar(20)
  representante  String?      @db.VarChar(20)
  contato        String?      @db.VarChar(20)
  observacao     String?      @db.VarChar(50)
  id_propriedade BigInt?
  created_at     DateTime     @default(now())
  updated_at     DateTime     @updatedAt
  Propriedade    Propriedade? @relation(fields: [id_propriedade], references: [id_propriedade])
  Coleta         Coleta[]

  @@map("industrias")
}

model Usuario {
  id_usuario                  BigInt               @id @default(autoincrement())
  auth_id                     String               @unique @db.VarChar(100)
  nome                        String               @db.VarChar(100)
  telefone                    String?              @db.VarChar(15)
  email                       String?              @db.VarChar(100)
  cargo                       String?              @db.VarChar(50)
  id_endereco                 BigInt?
  created_at                  DateTime             @default(now())
  updated_at                  DateTime             @updatedAt
  Endereco                    Endereco?            @relation(fields: [id_endereco], references: [id_endereco])
  Propriedade                 Propriedade[]        @relation("DonoPropriedade")
  DadosZootecnicos            DadosZootecnicos[]
  DadosSanitarios             DadosSanitarios[]
  AlimRegistro                AlimRegistro[]
  Coleta                      Coleta[]             @relation("FuncionarioColeta")
  EstoqueLeite                EstoqueLeite[]
  DadosLactacao               DadosLactacao[]
  PropriedadesComoFuncionario UsuarioPropriedade[]

  @@map("usuarios")
}

model Propriedade {
  id_propriedade   BigInt               @id @default(autoincrement())
  nome             String               @db.VarChar(100)
  id_dono          BigInt?
  id_endereco      BigInt?
  cnpj             String               @db.VarChar(18)
  p_abcb           Boolean?
  tipo_manejo      String?              @db.VarChar(1)
  created_at       DateTime             @default(now())
  updated_at       DateTime             @updatedAt
  Endereco         Endereco?            @relation(fields: [id_endereco], references: [id_endereco])
  Usuario          Usuario?             @relation("DonoPropriedade", fields: [id_dono], references: [id_usuario])
  Lote             Lote[]
  Bufalo           Bufalo[]
  EstoqueLeite     EstoqueLeite[]
  Funcionarios     UsuarioPropriedade[]
  Grupo            Grupo[]
  Alertas          Alertas[]
  AlimentacaoDef   AlimentacaoDef[]
  CicloLactacao    CicloLactacao[]
  Coleta           Coleta[]
  DadosLactacao    DadosLactacao[]
  DadosReproducao  DadosReproducao[]
  Industria        Industria[]
  MaterialGenetico MaterialGenetico[]
  Medicacoes       Medicacoes[]

  @@map("propriedades")
}

model UsuarioPropriedade {
  id_usuario     BigInt
  id_propriedade BigInt
  created_at     DateTime @default(now())

  Usuario     Usuario     @relation(fields: [id_usuario], references: [id_usuario])
  Propriedade Propriedade @relation(fields: [id_propriedade], references: [id_propriedade])

  @@id([id_usuario, id_propriedade])
  @@map("usuario_propriedade")
}

model Lote {
  id_lote         BigInt       @id @default(autoincrement())
  tipo_lote       String?      @db.VarChar(100)
  nome_lote       String       @db.VarChar(100)
  id_propriedade  BigInt?
  status          String?      @db.VarChar(20)
  descricao       String?      @db.VarChar(200)
  qtd_max         Int?
  geo_mapa        Json?        @db.JsonB
  area_m2         Decimal?     @db.Decimal(12, 2)
  created_at      DateTime     @default(now())
  updated_at      DateTime     @updatedAt
  Propriedade     Propriedade? @relation(fields: [id_propriedade], references: [id_propriedade])
  MovLoteAnterior MovLote[]    @relation("LoteAnterior")
  MovLoteAtual    MovLote[]    @relation("LoteAtual")

  @@map("lotes")
}

model Bufalo {
  id_bufalo             BigInt             @id @default(autoincrement())
  nome                  String?            @db.VarChar(20)
  brinco                String?            @db.VarChar(10)
  microchip             String?
  dt_nascimento         DateTime?
  nivel_maturidade      String?            @db.VarChar(1)
  sexo                  String?            @db.VarChar(1)
  data_baixa            DateTime?
  status                Boolean?
  motivo_inativo        String?            @db.VarChar(100)
  id_raca               BigInt?
  id_propriedade        BigInt?
  id_grupo              BigInt?
  origem                String?            @db.VarChar(10)
  brinco_original       String?            @db.VarChar(10)
  registro_prov         String?            @db.VarChar(10)
  registro_def          String?            @db.VarChar(10)
  categoria             String?            @db.VarChar(2)
  id_pai                BigInt?
  id_mae                BigInt?
  id_pai_semen          BigInt?
  created_at            DateTime           @default(now())
  updated_at            DateTime           @updatedAt
  Raca                  Raca?              @relation(fields: [id_raca], references: [id_raca])
  Propriedade           Propriedade?       @relation(fields: [id_propriedade], references: [id_propriedade])
  Grupo                 Grupo?             @relation(fields: [id_grupo], references: [id_grupo])
  Pai                   Bufalo?            @relation("Pai", fields: [id_pai], references: [id_bufalo], onDelete: NoAction, onUpdate: NoAction)
  Mae                   Bufalo?            @relation("Mae", fields: [id_mae], references: [id_bufalo], onDelete: NoAction, onUpdate: NoAction)
  FilhosPai             Bufalo[]           @relation("Pai")
  FilhosMae             Bufalo[]           @relation("Mae")
  DadosZootecnicos      DadosZootecnicos[]
  DadosSanitarios       DadosSanitarios[]
  MaterialGenetico      MaterialGenetico[] @relation("BufaloOrigem")
  DadosReproducaoBufala DadosReproducao[]  @relation("Bufala")
  DadosReproducaoBufalo DadosReproducao[]  @relation("Bufalo")
  CicloLactacao         CicloLactacao[]
  DadosLactacao         DadosLactacao[]
  Alertas               Alertas[]

  @@map("bufalos")
}

model MovLote {
  id_movimento     BigInt    @id @default(autoincrement())
  id_grupo         BigInt?
  id_lote_anterior BigInt?
  id_lote_atual    BigInt?
  dt_entrada       DateTime
  dt_saida         DateTime?
  created_at       DateTime  @default(now())
  updated_at       DateTime  @updatedAt
  Grupo            Grupo?    @relation(fields: [id_grupo], references: [id_grupo])
  LoteAnterior     Lote?     @relation("LoteAnterior", fields: [id_lote_anterior], references: [id_lote])
  LoteAtual        Lote?     @relation("LoteAtual", fields: [id_lote_atual], references: [id_lote])

  @@map("mov_lotes")
}

model DadosZootecnicos {
  id_zootec         BigInt   @id @default(autoincrement())
  id_bufalo         BigInt?
  id_usuario        BigInt?
  peso              Decimal? @db.Decimal(7, 2)
  condicao_corporal Decimal? @db.Decimal(4, 2)
  cor_pelagem       String?  @db.VarChar(30)
  formato_chifre    String?  @db.VarChar(30)
  porte_corporal    String?  @db.VarChar(30)
  dt_registro       DateTime
  tipo_pesagem      String?  @db.VarChar(50)
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt
  Bufalo            Bufalo?  @relation(fields: [id_bufalo], references: [id_bufalo])
  Usuario           Usuario? @relation(fields: [id_usuario], references: [id_usuario])

  @@map("dados_zootecnicos")
}

model Medicacoes {
  id_medicacao    BigInt            @id @default(autoincrement())
  tipo_tratamento String?           @db.VarChar(30)
  medicacao       String?           @db.VarChar(30)
  descricao       String?           @db.VarChar(100)
  id_propriedade  BigInt?
  created_at      DateTime          @default(now())
  updated_at      DateTime          @updatedAt
  Propriedade     Propriedade?      @relation(fields: [id_propriedade], references: [id_propriedade])
  DadosSanitarios DadosSanitarios[]

  @@map("medicacoes")
}

model DadosSanitarios {
  id_sanit          BigInt      @id @default(autoincrement())
  id_bufalo         BigInt?
  id_usuario        BigInt?
  id_medicao        BigInt?
  dt_aplicacao      DateTime
  dosagem           Decimal?    @db.Decimal(8, 2)
  unidade_medida    String?     @db.VarChar(20)
  doenca            String?     @db.VarChar(100)
  necessita_retorno Boolean?
  dt_retorno        DateTime?
  created_at        DateTime    @default(now())
  updated_at        DateTime    @updatedAt
  Bufalo            Bufalo?     @relation(fields: [id_bufalo], references: [id_bufalo])
  Usuario           Usuario?    @relation(fields: [id_usuario], references: [id_usuario])
  Medicacoes        Medicacoes? @relation(fields: [id_medicao], references: [id_medicacao])

  @@map("dados_sanitarios")
}

model MaterialGenetico {
  id_material          BigInt            @id @default(autoincrement())
  tipo                 String?           @db.VarChar(20)
  origem               String?           @db.VarChar(20)
  id_bufalo_origem     BigInt?
  fornecedor           String?           @db.VarChar(100)
  data_coleta          DateTime?
  id_propriedade       BigInt?
  created_at           DateTime          @default(now())
  updated_at           DateTime          @updatedAt
  Propriedade          Propriedade?      @relation(fields: [id_propriedade], references: [id_propriedade])
  BufaloOrigem         Bufalo?           @relation("BufaloOrigem", fields: [id_bufalo_origem], references: [id_bufalo])
  DadosReproducaoOvulo DadosReproducao[] @relation("Ovulo")
  DadosReproducaoSemen DadosReproducao[] @relation("Semen")

  @@map("material_genetico")
}

model DadosReproducao {
  id_reproducao    BigInt            @id @default(autoincrement())
  id_ovulo         BigInt?
  id_semen         BigInt?
  id_bufala        BigInt?
  id_bufalo        BigInt?
  tipo_inseminacao String?           @db.VarChar(50)
  status           String?           @db.VarChar(20)
  tipo_parto       String?           @db.VarChar(20)
  dt_evento        DateTime
  ocorrencia       String?           @db.VarChar(50)
  id_propriedade   BigInt?
  created_at       DateTime          @default(now())
  updated_at       DateTime          @updatedAt
  Propriedade      Propriedade?      @relation(fields: [id_propriedade], references: [id_propriedade])
  Ovulo            MaterialGenetico? @relation("Ovulo", fields: [id_ovulo], references: [id_material])
  Semen            MaterialGenetico? @relation("Semen", fields: [id_semen], references: [id_material])
  Bufala           Bufalo?           @relation("Bufala", fields: [id_bufala], references: [id_bufalo])
  Bufalo           Bufalo?           @relation("Bufalo", fields: [id_bufalo], references: [id_bufalo])

  @@map("dados_reproducao")
}

model AlimRegistro {
  id_registro    BigInt          @id @default(autoincrement())
  id_grupo       BigInt?
  id_aliment_def BigInt?
  id_usuario     BigInt?
  quantidade     Decimal?        @db.Decimal(8, 2)
  unidade_medida String?         @db.VarChar(20)
  freq_dia       Int?
  dt_registro    DateTime
  created_at     DateTime        @default(now())
  updated_at     DateTime        @updatedAt
  Grupo          Grupo?          @relation(fields: [id_grupo], references: [id_grupo])
  AlimentacaoDef AlimentacaoDef? @relation(fields: [id_aliment_def], references: [id_aliment_def])
  Usuario        Usuario?        @relation(fields: [id_usuario], references: [id_usuario])

  @@map("alim_registros")
}

model Coleta {
  id_coleta       BigInt       @id @default(autoincrement())
  id_industria    BigInt?
  resultado_teste Boolean?
  observacao      String?      @db.VarChar(50)
  quantidade      Decimal?     @db.Decimal(8, 3)
  dt_coleta       DateTime?
  id_funcionario  BigInt?
  id_propriedade  BigInt?
  created_at      DateTime     @default(now())
  updated_at      DateTime     @updatedAt
  Propriedade     Propriedade? @relation(fields: [id_propriedade], references: [id_propriedade])
  Industria       Industria?   @relation(fields: [id_industria], references: [id_industria])
  Funcionario     Usuario?     @relation("FuncionarioColeta", fields: [id_funcionario], references: [id_usuario])

  @@map("coletas")
}

model EstoqueLeite {
  id_estoque     BigInt       @id @default(autoincrement())
  id_propriedade BigInt?
  id_usuario     BigInt?
  quantidade     Decimal?     @db.Decimal(10, 3)
  dt_registro    DateTime?
  observacao     String?      @db.VarChar(50)
  created_at     DateTime     @default(now())
  updated_at     DateTime     @updatedAt
  Propriedade    Propriedade? @relation(fields: [id_propriedade], references: [id_propriedade])
  Usuario        Usuario?     @relation(fields: [id_usuario], references: [id_usuario])

  @@map("estoque_leite")
}

model CicloLactacao {
  id_ciclo_lactacao   BigInt          @id @default(autoincrement())
  id_bufala           BigInt
  dt_parto            DateTime
  padrao_dias         Int
  dt_secagem_prevista DateTime?
  dt_secagem_real     DateTime?
  status              String          @default("Em Lactação") @db.VarChar(20)
  observacao          String?
  id_propriedade      BigInt?
  created_at          DateTime        @default(now())
  updated_at          DateTime        @updatedAt
  Propriedade         Propriedade?    @relation(fields: [id_propriedade], references: [id_propriedade])
  Bufala              Bufalo          @relation(fields: [id_bufala], references: [id_bufalo])
  DadosLactacao       DadosLactacao[]

  @@map("ciclos_lactacao")
}

model DadosLactacao {
  id_lact           BigInt         @id @default(autoincrement())
  id_bufala         BigInt?
  id_usuario        BigInt?
  id_ciclo_lactacao BigInt?
  qt_ordenha        Decimal?       @db.Decimal(8, 3)
  periodo           String?        @db.VarChar(1)
  ocorrencia        String?        @db.VarChar(50)
  dt_ordenha        DateTime
  id_propriedade    BigInt?
  created_at        DateTime       @default(now())
  updated_at        DateTime       @updatedAt
  Propriedade       Propriedade?   @relation(fields: [id_propriedade], references: [id_propriedade])
  Bufala            Bufalo?        @relation(fields: [id_bufala], references: [id_bufalo])
  Usuario           Usuario?       @relation(fields: [id_usuario], references: [id_usuario])
  CicloLactacao     CicloLactacao? @relation(fields: [id_ciclo_lactacao], references: [id_ciclo_lactacao])

  @@map("dados_lactacao")
}

model Alertas {
  id_alerta          BigInt           @id @default(autoincrement())
  animal_id          BigInt
  grupo              String           @db.VarChar(100)
  localizacao        String           @db.VarChar(100)
  motivo             String           @db.Text
  nicho              NichoAlerta
  data_alerta        DateTime
  prioridade         PrioridadeAlerta
  observacao         String?          @db.Text
  visto              Boolean          @default(false)
  id_evento_origem   BigInt?
  tipo_evento_origem String?          @db.VarChar(50)
  id_propriedade     BigInt?
  created_at         DateTime         @default(now())
  updated_at         DateTime         @updatedAt
  Propriedade        Propriedade?     @relation(fields: [id_propriedade], references: [id_propriedade])
  Bufalo             Bufalo           @relation(fields: [animal_id], references: [id_bufalo])

  @@map("alertas")
}

